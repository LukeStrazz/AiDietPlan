@page
@model Services.ViewModels.UserInfoViewModel
@{
}

<form id="userCreateForm" class="row g-3 needs-validation" novalidate>
    <div class="col-md-4">
        <label for="firstName" class="form-label">First name</label>
        <input type="text" class="form-control" id="firstName" placeholder="John" required>
    </div>
    <div class="col-md-4">
        <label for="lastName" class="form-label">Last name</label>
        <input type="text" class="form-control" id="lastName" placeholder="Doe" required>
    </div>
    <div class="col-md-4">
        <label for="validationCustomUsername" class="form-label">Username</label>
        <div class="input-group has-validation">
            <span class="input-group-text" id="inputGroupUsername">@@</span>
            <input type="text" class="form-control" id="validationCustomUsername" aria-describedby="inputGroupUsername" placeholder="JohnDoe123" required>
        </div>
    </div>
    <div class="col-md-4">
        <label for="Email" class="form-label">Email</label>
        <div class="input-group has-validation">
            <span class="input-group-text" id="inputGroupEmail">@@</span>
            <input type="text" class="form-control" id="Email" aria-describedby="inputGroupEmail" placeholder="john@doe.com" required>
        </div>
    </div>
    <div class="col-md-4">
        <label for="Birthday" class="form-label">Birthday</label>
        <input type="text" class="form-control" id="Birthday" placeholder="1/1/2001" required>
    </div>
    <div class="col-md-4">
        <label for="Weight" class="form-label">Weight (lbs)</label>
        <input type="text" class="form-control" id="Weight" placeholder="123" required>
    </div>
    <div class="col-md-4">
        <label for="Allergies" class="form-label">Allergies (comma separated)</label>
        <input type="text" class="form-control" id="Allergies" placeholder="e.g., Peanuts, Shellfish, Pollen">
    </div>
    <div class="col-12">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="invalidCheck" required>
            <label class="form-check-label" for="invalidCheck">
                Agree to terms and conditions
            </label>
            <div class="invalid-feedback">
                You must agree before submitting.
            </div>
        </div>
    </div>
    <div class="col-12">
        <button class="btn btn-primary" type="submit">Submit form</button>
    </div>
</form>

<script>
    $(document).ready(function () {
        $("#userCreateForm").on("submit", function (e) {
            e.preventDefault();
            debugger;
            if (!$("#invalidCheck").is(":checked")) {
                e.preventDefault();
                return alert("Please agree before submitting.");
            }

            var firstName = $("#firstName").val().trim();
            var lastName = $("#lastName").val().trim();
            var email = $("#Email").val().trim();
            var username = $("#validationCustomUsername").val().trim();
            var birthday = $("#Birthday").val().trim();
            var weight = parseFloat($("#Weight").val()) || 0;
            var allergies = $("#Allergies").val().trim();

            if (!firstName || !lastName || !username || !birthday || !weight || !email) {
                alert("Please fill out all required fields.");
                return;
            }

            var formattedBirthday = new Date(birthday).toISOString();

            var userInfo = {
                FirstName: firstName,
                LastName: lastName,
                Username: username,
                Email: email,
                Birthday: formattedBirthday,
                StartingWeight: weight,
                Allergies: allergies ? allergies.split(',').map(a => a.trim()) : []
            };

            $.ajax({
                url: '/api/UserCreateController/CreateUser',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(userInfo),
                success: function (response) {
                    alert(response.message);
                },
                error: function (xhr, status, error) {
                    alert('Error: ' + xhr.responseText);
                }
            });
        });
    });

</script>
